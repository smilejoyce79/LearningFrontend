<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="./style.css">
  <link rel="icon" href="https://fav.farm/ğŸ”¥" />
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
  
  <script>
    const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

    const cities = [];
    // fetch(endpoint,function(data){console.log(data)})
    // const prom = fetch(endpoint);
    // console.log(prom)

    fetch(endpoint)  //ç¨‹å¼ç™¼é€ä¸€å€‹GETè«‹æ±‚åˆ°æŒ‡å®šçš„URLï¼Œä¸¦ç­‰å¾…å›æ‡‰ã€‚
      .then( blob => blob.json() )  //å›æ‡‰æˆåŠŸå¾Œï¼Œå°‡å›æ‡‰çš„å…§å®¹è½‰æ›ç‚ºJSONæ ¼å¼ã€‚
      .then( data => cities.push(...data))  //å°‡ç²å¾—çš„ JSON è³‡æ–™å­˜å„²åœ¨ cities é™£åˆ—ä¸­ï¼Œè®“ç¨‹å¼å¾ŒçºŒå¯ä»¥ä½¿ç”¨é€™äº›æ•¸æ“šã€‚
      // .then( data => console.log(data) )

    /*
    [function findMatches åœ¨åšä»€éº¼]
    å–å¾—2å€‹è®Šæ•¸: wordToMatchæ˜¯inputçš„å€¼,citiesæ˜¯è¦æŸ¥æ‰¾çš„è³‡æ–™ä¾†æº;
    å°‡citiesç”¨filterç¯©é¸åŒ¹é…wordToMatchçš„é …ç›®æ‰returnå›å‚³;
        .filter( fucntion(x)ç¶“æ¢ä»¶åˆ¤æ–·return )
        =new RegExp(è¦åŒ¹é…çš„å€¼,'gi')
    */
    function findMatches(wordToMatch, cities) {
      return cities.filter(place => {
        const regex = new RegExp(wordToMatch, 'gi'); //gå…¨åŸŸ(æœå°‹ç¯„åœç‚ºæ•´å€‹å­—ä¸²) iä¸åˆ†å¤§å°å¯«
        return place.city.match(regex) || place.state.match(regex)
      });
    }

    function numberWithCommas(x) {
      return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    /*
    [function displayMatches åœ¨åšä»€éº¼]
    å°‡inputçš„å€¼(this.value)å’Œè¦æŸ¥æ‰¾çš„è³‡æ–™ä¾†æº(cities)ä¸Ÿå…¥findMatchesç¯©é¸å‡ºç¬¦åˆçš„é …ç›®,å°‡åŒ¹é…çµæœ(ä¸€çµ„Array)å­˜å…¥matchArray;
    å°‡matchArrayç”¨mapä¸€å€‹å€‹å–å‡º,æ”¾å…¥ li>span.name / span.population çš„htmlçµæ§‹,å­˜å…¥html;
      mapå–å‡ºå¾Œ,å°‡cityå’Œstateçš„å€¼ ç”¨replaceå°‡åŒ¹é…ç¬¦åˆthis.valueçš„éƒ¨åˆ†å–ä»£æˆ span.h1 çš„ htmlçµæ§‹, å­˜å…¥cityName / stateName;
    å°‡htmlç”¨.innerHTMLæ”¹å¯«.sugesstionsé€™å€‹ç¯€é»å…§å®¹
        .map( function(x)ç¶“æŒ‡å®šæ ¼å¼return )
        .join('') æŒ‡å®šç¬¦è™Ÿä¾†ä¸²æ¥èµ·mapå‡ºä¾†çš„é€é …å€¼
        .replace( a , b ) å°‡aå–ä»£æˆb
    */
    function displayMatches(){
      //console.log(this.value); //å°å‡ºinputè¼¸å…¥çš„å€¼
      const matchArray = findMatches(this.value, cities);
      // console.log(matchArray)
      
      const html = matchArray.map(place => {
        const regex = new RegExp(this.value, 'gi');
        const cityName = place.city.replace(regex, `<span class="h1">${this.value}</span>`);
        //æŠ“å–place.cityçš„å€¼ï¼›ç”¨RegExpæœå°‹å…¶ä¸­åŒ¹é…this.valueçš„å­—å…ƒï¼Œç”¨.replceå–ä»£
        const stateName = place.state.replace(regex,`<span class="h1">${this.value}</span>`);
        return `
          <li>
            <span class="name">${cityName}, ${stateName}</span>
            <span class="population">${numberWithCommas(place.population)}</span>
          </li>
        `;
      }).join('');  //join å°‡é™£åˆ—ä¸­çš„å€¼è½‰è®Šç‚ºå­—ä¸²ï¼Œä¸¦ä¸”åŠ å…¥ç‰¹å®šå­—å…ƒä½œç‚ºå€¼ç›¸é–“çš„ç¬¦è™Ÿ
      suggestions.innerHTML = html;
    }

    const searchInput = document.querySelector('.search');
    const suggestions = document.querySelector('.suggestions');

    searchInput.addEventListener('change', displayMatches);  //è¼¸å…¥å®Œç•¢,è·³å‡ºinputå¾Œæ‰æœƒæŠ“å–
    searchInput.addEventListener('keyup', displayMatches);  //æ¯æŒ‰ä¸€å€‹éµéƒ½æœƒæŠ“å–

  </script>
</body>
</html>
